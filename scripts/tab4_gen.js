import{removeAllItemsFromSidebar}from"./setup.js";async function getChatCompletion(e,t,n,o,a){const d=JSON.stringify({model:t,messages:[{role:"system",content:a},{role:"user",content:n}],max_tokens:2048,n:1,temperature:parseFloat(o)}),r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:d});if(!r.ok){await r.json();throw new Error("Failed to fetch chat completion: "+r.statusText)}return(await r.json()).choices[0].message.content}document.addEventListener("DOMContentLoaded",(()=>{const e=localStorage.getItem("apiKey"),t=document.getElementById("textbox-gen"),n=document.getElementById("tb4-text-input-2"),o=document.getElementById("tb4-text-input-3");e?(t.value=e,n.setAttribute("data-placeholder","Generation Appears Here"),o.setAttribute("data-placeholder","Generation Appears Here")):(n.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),o.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings.")),document.querySelector("#tb4-settings-button-gen-1").addEventListener("click",(function(){event.stopPropagation(),document.getElementById("settingsModal-gen").style.display="block"})),document.querySelector("#tb4-settings-button-gen-2").addEventListener("click",(function(){event.stopPropagation(),document.getElementById("settingsModal-gen").style.display="block"})),document.getElementById("saveOptions-gen").addEventListener("click",(function(){const e=document.getElementById("textbox-gen").value;localStorage.setItem("apiKey",e),document.getElementById("settingsModal-gen").style.display="none"})),document.getElementById("closeSettingsModal-gen").addEventListener("click",(function(){document.getElementById("settingsModal-gen").style.display="none"})),document.querySelector("#tb4-temperature-button-1").addEventListener("click",(function(){event.stopPropagation();document.getElementById("tb4-temperature-slider-popup-1").style.display="block"}));const a=document.getElementById("tb4-temperature-slider-1"),d=document.getElementById("tb4-temperature-value-icon-1");a.addEventListener("input",(function(){d.textContent=parseFloat(a.value).toFixed(1)})),document.querySelector("#tb4-temperature-button-2").addEventListener("click",(function(){event.stopPropagation();document.getElementById("tb4-temperature-slider-popup-2").style.display="block"}));const r=document.getElementById("tb4-temperature-slider-2"),l=document.getElementById("tb4-temperature-value-icon-2");r.addEventListener("input",(function(){l.textContent=parseFloat(r.value).toFixed(1)})),document.addEventListener("click",(function(e){const t=document.getElementById("tb4-temperature-slider-popup-1"),n=document.getElementById("tb4-temperature-slider-popup-2");t.contains(e.target)||(t.style.display="none"),n.contains(e.target)||(n.style.display="none")})),document.getElementById("settingsModal-gen").addEventListener("click",(e=>{e.target===e.currentTarget&&document.getElementById("saveOptions-gen").click()})),window.addEventListener("keydown",(function(e){const t=document.getElementById("settingsModal-gen"),n=document.getElementById("tb4-temperature-slider-popup-1"),o=document.getElementById("tb4-temperature-slider-popup-2");"Escape"===e.key&&(t.style.display="none",n.style.display="none",o.style.display="none")})),document.querySelector("#tb4-generate-button-1").addEventListener("click",(function(){removeAllItemsFromSidebar("tb4-sidebar-content-2");const e=localStorage.getItem("apiKey"),t=document.getElementById("tb4-dropdown-gen-1").value,n=document.getElementById("tb4-text-input-1").innerText,o=document.getElementById("tb4-temperature-slider-1").value,a=document.getElementById("tb4-text-input-2"),d=(new Date).toLocaleDateString();let r;r="gpt-4"===t?"You are GPT-4, a large language model trained by OpenAI. Answer as concisely as possible":"You are ChatGPT, a large language model trained by OpenAI. Answer as concisely as possible. Knowledge cutoff: 2021-09-01 Current date: "+d,e?(a.innerText="",a.setAttribute("data-placeholder","Loading..."),getChatCompletion(e,t,n,o,r).then((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText=e})).catch((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText="Error: "+e.message}))):alert("Please add the API key in settings.")})),document.querySelector("#tb4-generate-button-2").addEventListener("click",(function(){removeAllItemsFromSidebar("tb4-sidebar-content-3");const e=localStorage.getItem("apiKey"),t=document.getElementById("tb4-dropdown-gen-2").value,n=document.getElementById("tb4-text-input-1").innerText,o=document.getElementById("tb4-temperature-slider-2").value,a=document.getElementById("tb4-text-input-3"),d=(new Date).toLocaleDateString();let r;r="gpt-4"===t?"You are GPT-4, a large language model trained by OpenAI. Answer as concisely as possible":"You are ChatGPT, a large language model trained by OpenAI. Answer as concisely as possible. Knowledge cutoff: 2021-09-01 Current date: "+d,e?(a.innerText="",a.setAttribute("data-placeholder","Loading..."),getChatCompletion(e,t,n,o,r).then((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText=e})).catch((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText="Error: "+e.message}))):alert("Please add the API key in settings.")}))}));
