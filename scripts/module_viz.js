function t(t,e){const a=d3.select("#"+t+" svg").node(),n=a.viewBox.baseVal.width,o=a.viewBox.baseVal.height,r=d3.select("#"+t+" svg g").node().getBBox(),i=n/2-(r.x+r.width/2)*e,s=o/2-(r.y+r.height/2)*e;d3.select("#"+t+" svg g").attr("transform",`translate(${i}, ${s}) scale(${e})`)}function e(e,a,n){if(2===a){let a=e[0],o=e[1];if(a<1&&o<1){const e=Math.max(a,o);if(a<e){t(n+"-1",a/e)}else if(o<e){t(n+"-2",o/e)}}}else if(3===a){let a=e[0],o=e[1],r=e[2];if(a<1&&o<1&&r<1){const e=Math.max(a,o,r);if(a<e){t(n+"-1",a/e)}if(o<e){t(n+"-2",o/e)}if(r<e){t(n+"-3",r/e)}}}}export const tab_create_viz=(t,a)=>{if("tab2"===a){n(t+"-1");i(t+"-1","tb2-text-input","tb2-sidebar")}else if("tab3"===a){n(t+"-1"),n(t+"-2"),null!==(o=document.getElementById("tb3-visualization-combined-export-btn"))&&o.remove(),e([i(t+"-1","tb3-text-input-1","tb3-sidebar-1"),i(t+"-2","tb3-text-input-2","tb3-sidebar-2")],2,t),c(t,t+"-1")}else if("tab4"===a){var o;n(t+"-1"),n(t+"-2"),n(t+"-3"),null!==(o=document.getElementById("tb4-visualization-combined-export-btn"))&&o.remove(),e([i(t+"-1","tb4-text-input-1","tb4-sidebar-1"),i(t+"-2","tb4-text-input-2","tb4-sidebar-2"),i(t+"-3","tb4-text-input-3","tb4-sidebar-3")],3,t),c(t,t+"-1",3)}};function a(t){const e=d3.hsl(t);e.l-=.2,e.l=Math.max(0,Math.min(1,e.l));return d3.rgb(e).toString()}document.querySelectorAll(".visualization").forEach((t=>{t.style.display="none"}));const n=t=>{const e=document.querySelector("#"+t);for(;e.firstChild;)e.removeChild(e.firstChild)};function o(t,e){const a=t.getBBox();return{x:a.x-e,y:a.y-e,width:a.width+2*e,height:a.height+2*e}}const r=(t,e,a,n,r,i,s,l)=>{const c=3.5*i,d=t.selectAll("text").filter((function(){return this!==l}));let h=a+c,x=a-c,y=e-n/2;const p=t=>{let e=0;return d.each((function(){const a=o(this,s);y+n>a.x&&y<a.x+a.width&&(t+r>a.y&&t<a.y+a.height||t-r>a.y&&t-r<a.y+a.height)&&e++})),e},u=p(h),f=p(x),g=u===f?Math.random()<.5?h:x:u<f?h:x;return{x:y,y:g}},i=(t,e,n,i=40,c=600,d=335)=>{const h=document.querySelector("#"+e),x=document.querySelector("#"+n),y=d3.select("#"+t).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+c+" "+d).attr("preserveAspectRatio","xMidYMid meet"),p=y.append("g"),u=Array.from(h.childNodes),f=x.querySelectorAll('.item-wrapper:not([data-type="horizontal-line"])'),g={};f.forEach((t=>{const e=t.querySelector(".color-index-container").id.slice(-6),a=t.querySelectorAll(".color-description-input"),n=t.querySelectorAll(".description-dropdown"),o=Array.from(a).map(((t,e)=>`${""!=n[e].value?n[e].value+": ":""} ${t.value}`.trim())).join("\n");g[e]=o}));let m=0,b=20;const w=10*i,v=new Set,E=[],M=[];u.forEach(((t,e)=>{if(t.nodeType===Node.TEXT_NODE){t.textContent.split(" ").forEach((t=>{const e=p.append("text").attr("x",-9999).attr("y",-9999).text(t),a=e.node().getComputedTextLength();e.remove();m+a>w&&(m=0,b+=35);p.append("text").attr("x",m).attr("y",b).text(t);E.push(m),m+=a+5}))}else if(t.nodeType===Node.ELEMENT_NODE){const e=t,a=e.className.slice(-6),n=e.className.includes("color-highlight"),o=e.className.includes("strikethrough"),r=e.textContent.split(" "),i=Math.floor((r.length+1)/2)-1;let s;r.forEach(((t,e)=>{const r=p.append("text").attr("x",-9999).attr("y",-9999).text(t),l=r.node().getComputedTextLength();r.remove();m+l>w&&(m=0,b+=35),e===i&&(s=m);p.append("text").attr("x",m).attr("y",b).text(t).style("pointer-events","none");if(e===i&&(s=m+l/2),n){p.insert("rect","text").attr("x",m-3).attr("y",b-15).attr("width",l+6).attr("height",20).attr("fill",`#${a}`)}if(o){p.insert("line","text").attr("x1",m-3).attr("y1",b-5).attr("x2",m+l+2).attr("y2",b-5).attr("stroke",`#${a}`).attr("stroke-width",2)}m+=l+5})),g[a]&&!v.has(e)&&(v.add(e),M.push({color:a,middleWordX:s,currentY:b,annotationLines:g[a].split("\n")}))}})),M.filter((({annotationLines:t})=>t.some((t=>""!==t.trim())))).forEach((({color:t,middleWordX:e,currentY:n,annotationLines:i})=>{const c=p.append("g").on("mouseover",(function(){l(d3.select(this))})).on("mouseout",(function(){!function(t){t.selectAll(".drag-handle").style("display","none")}(d3.select(this))})).on("touchstart",(function(){l(d3.select(this))})),d=c.append("text").attr("x",e-6).attr("y",n).style("fill",a(`#${t}`)).style("font-size","14px").style("pointer-events","none");i.forEach(((t,a)=>{d.append("tspan").text(t).attr("x",e-6).attr("dy",0===a?0:20)}));const h=o(d.node(),5),x=r(p,e,n,h.width,h.height,20,5,d.node());d.attr("x",x.x).attr("y",x.y),d.selectAll("tspan").attr("x",x.x);const y=o(d.node(),5),u=y.x,f=y.x+y.width,g=y.y,m=y.y+y.height,b=e,w=n,v=[{x:u,y:(g+m)/2},{x:f,y:(g+m)/2},{x:(u+f)/2,y:g},{x:(u+f)/2,y:m}].reduce(((t,e)=>{const a=Math.sqrt(Math.pow(t.x-b,2)+Math.pow(t.y-w,2));return Math.sqrt(Math.pow(e.x-b,2)+Math.pow(e.y-w,2))<a?e:t})),E=c.append("line").attr("x1",e-6).attr("y1",n).attr("x2",v.x).attr("y2",v.y).attr("stroke",a(`#${t}`)).attr("stroke-width",1.5),M=c.append("circle").attr("cx",v.x).attr("cy",v.y).attr("r",3).attr("fill",a(`#${t}`));x.y<n?d.attr("y",parseFloat(d.attr("y"))-5):d.attr("y",parseFloat(d.attr("y"))+5);const B=c.append("circle").attr("class","drag-handle draggable").attr("cx",v.x).attr("cy",v.y).attr("r",4).attr("fill","blue").style("cursor","move").style("display","none");B.call(s(((t,e)=>{B.attr("cx",parseFloat(B.attr("cx"))+t).attr("cy",parseFloat(B.attr("cy"))+e);const a=parseFloat(d.attr("x"))+t,n=parseFloat(d.attr("y"))+e;d.attr("x",a).attr("y",n),d.selectAll("tspan").attr("x",a),E.attr("x2",parseFloat(E.attr("x2"))+t).attr("y2",parseFloat(E.attr("y2"))+e),M.attr("cx",parseFloat(M.attr("cx"))+t).attr("cy",parseFloat(M.attr("cy"))+e)}),(()=>{const t=o(d.node(),5),e=t.x,a=t.x+t.width,n=t.y,r=t.y+t.height,i=[{x:e,y:(n+r)/2},{x:a,y:(n+r)/2},{x:(e+a)/2,y:n},{x:(e+a)/2,y:r}].reduce(((t,e)=>{const a=Math.sqrt(Math.pow(t.x-b,2)+Math.pow(t.y-w,2));return Math.sqrt(Math.pow(e.x-b,2)+Math.pow(e.y-w,2))<a?e:t}));E.attr("x2",i.x).attr("y2",i.y),M.attr("cx",i.x).attr("cy",i.y),B.attr("cx",i.x).attr("cy",i.y)})));const $=c.append("circle").attr("class","drag-handle draggable").attr("cx",e-6).attr("cy",n).attr("r",4).attr("fill","blue").style("cursor","move").style("display","none");$.call(s(((t,e)=>{E.attr("x1",parseFloat(E.attr("x1"))+t).attr("y1",parseFloat(E.attr("y1"))+e),$.attr("cx",parseFloat($.attr("cx"))+t).attr("cy",parseFloat($.attr("cy"))+e)}),(()=>{})))}));const B=p.node().getBBox(),$=`0 0 ${B.width+40} ${B.height+40}`;y.attr("viewBox",$);const A=20-B.x,S=20-B.y;return p.attr("transform",`translate(${A}, ${S})`),function(t,e){const a=document.getElementById(e),n=document.createElement("button");n.className="download-svg-btn",n.id=e+"-export-btn",n.innerHTML='\n  <i class="fas fa-file-download"></i>',n.onclick=()=>{!function(t){const e=t.node().cloneNode(!0);!function(t){const e=document.styleSheets,a=document.createElement("style");let n="";for(const t of e){let e;try{e=t.rules||t.cssRules}catch(t){continue}for(const t of e)n+=`${t.cssText}\n`}a.innerHTML=n,t.insertBefore(a,t.firstChild)}(e);const a=function(t){const e=t.select("g").node().parentNode;return e.getBBox()}(t);e.setAttribute("viewBox",`${a.x} ${a.y} ${a.width} ${a.height}`);const n=(new XMLSerializer).serializeToString(e),o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n))),r=e.getAttribute("viewBox").split(" ").map(parseFloat),i=r[2],s=r[3],l=1200,c=l/(i/s),d=new Image;d.src=o;const h=document.createElement("canvas");h.width=l,h.height=c;const x=h.getContext("2d");d.onload=()=>{x.drawImage(d,0,0,h.width,h.height);const t=h.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="visualization.png",e.click()}}(t)},a.appendChild(n)}(y,t),(B.width+40)/c};function s(t,e){let a,n;return d3.drag().on("start",(t=>{t.sourceEvent.stopPropagation(),a=t.x,n=t.y})).on("drag",(e=>{const o=e.x-a,r=e.y-n;a=e.x,n=e.y,t.call(this,o,r)})).on("end",e)}function l(t){t.selectAll(".drag-handle").style("display","block")}function c(t,e,a=2){const n=document.getElementById(e),o=document.createElement("button");o.className="download-svg-combined-btn",o.id=t+"-combined-export-btn";2==a?o.innerHTML='\n  <i class="fas fa-file-download"></i><i class="fas fa-plus"></i><i class="fas fa-file-download"></i>':3==a&&(o.innerHTML='\n  <i class="fas fa-file-download"></i><i class="fas fa-plus"></i><i class="fas fa-file-download"></i><i class="fas fa-plus"></i><i class="fas fa-file-download"></i>'),o.onclick=()=>{!function(t){const e=document.getElementById(t),a=Array.from(e.querySelectorAll(".subvisualization")),n=600,o=335*a.length,r=document.createElement("canvas");r.width=n,r.height=o;const i=r.getContext("2d");let s=0;a.forEach(((t,e)=>{const o=t.querySelector("svg"),l=o.cloneNode(!0),c=o.clientWidth,d=o.clientHeight*(n/c);l.setAttribute("width",n),l.setAttribute("height",d);const h=new Image;h.onload=()=>{if(i.drawImage(h,0,s,n,d),s+=d,e===a.length-1){const t=r.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="combined_visualization.png",e.click()}},h.onerror=t=>{};const x=(new XMLSerializer).serializeToString(l),y=new Blob([x],{type:"image/svg+xml"}),p=URL.createObjectURL(y);h.src=p}))}(t)},n.appendChild(o)}
