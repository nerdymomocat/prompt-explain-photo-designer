import{removeAllItemsFromSidebar}from"./setup.js";async function getChatCompletion(e,t,n,o,a){const d=JSON.stringify({model:t,messages:[{role:"system",content:a},{role:"user",content:n}],max_tokens:2048,n:1,temperature:parseFloat(o)}),s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:d});if(!s.ok){await s.json();throw new Error("Failed to fetch chat completion: "+s.statusText)}return(await s.json()).choices[0].message.content}document.addEventListener("DOMContentLoaded",(()=>{const e=localStorage.getItem("apiKey"),t=document.getElementById("textbox-gen"),n=document.getElementById("tb3-text-input-2");e?(t.value=e,n.setAttribute("data-placeholder","Generation Appears Here")):n.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),document.querySelector("#tb3-settings-button-gen").addEventListener("click",(function(){event.stopPropagation(),document.getElementById("settingsModal-gen").style.display="block"})),document.getElementById("saveOptions-gen").addEventListener("click",(function(){const e=document.getElementById("textbox-gen").value;localStorage.setItem("apiKey",e),document.getElementById("settingsModal-gen").style.display="none"})),document.getElementById("closeSettingsModal-gen").addEventListener("click",(function(){document.getElementById("settingsModal-gen").style.display="none"})),document.querySelector("#tb3-temperature-button").addEventListener("click",(function(){event.stopPropagation();document.getElementById("tb3-temperature-slider-popup").style.display="block"}));const o=document.getElementById("tb3-temperature-slider"),a=document.getElementById("tb3-temperature-value-icon");o.addEventListener("input",(function(){a.textContent=parseFloat(o.value).toFixed(1)})),document.addEventListener("click",(function(e){const t=document.getElementById("tb3-temperature-slider-popup");t.contains(e.target)||(t.style.display="none")})),document.getElementById("settingsModal-gen").addEventListener("click",(e=>{e.target===e.currentTarget&&document.getElementById("saveOptions-gen").click()})),window.addEventListener("keydown",(function(e){const t=document.getElementById("settingsModal-gen"),n=document.getElementById("tb3-temperature-slider-popup");"Escape"===e.key&&(t.style.display="none",n.style.display="none")})),document.querySelector("#tb3-generate-button").addEventListener("click",(function(){removeAllItemsFromSidebar("tb3-sidebar-content-2");const e=localStorage.getItem("apiKey"),t=document.getElementById("tb3-dropdown-gen").value,n=document.getElementById("tb3-text-input-1").innerText,o=document.getElementById("tb3-temperature-slider").value,a=document.getElementById("tb3-text-input-2"),d=(new Date).toLocaleDateString();let s;s="gpt-4"===t?"You are GPT-4, a large language model trained by OpenAI. Answer as concisely as possible":"You are ChatGPT, a large language model trained by OpenAI. Answer as concisely as possible. Knowledge cutoff: 2021-09-01 Current date: "+d,e?(a.innerText="",a.setAttribute("data-placeholder","Loading..."),getChatCompletion(e,t,n,o,s).then((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText=e})).catch((e=>{a.setAttribute("data-placeholder","Generation Appears Here.\nAdd the API key in settings."),a.innerText="Error: "+e.message}))):alert("Please add the API key in settings.")}))}));
